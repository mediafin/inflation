#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
inflation = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
df_inflation_hbs_wt %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date")
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL==0) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
inflation = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
df_inflation_hbs_wt %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = inflation -  MS_CPI_INFL) #difference between published en reproduced inflation
df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = inflation -  MS_CPI_INFL) #difference between published en reproduced inflation
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL==0) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
inflation = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = inflation -  MS_CPI_INFL) #difference between published en reproduced inflation
infl_comparisson
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL==0) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
inflation = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = inflation -  MS_CPI_INFL) #difference between published en reproduced inflation
infl_comparisson
mean(infl_comparisson$diff, na.rm=T)
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL==0) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
inflation = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = inflation -  MS_CPI_INFL) #difference between published en reproduced inflation
infl_comparisson
mean(infl_comparisson$diff, na.rm=T)
#list of hbs-categories included by nbb
include_selection <- read.csv("data/nbb-level2-products.csv", sep=";", stringsAsFactors = F, colClasses="character")
#additional products to be removed from subset
exclude_selection <- c(
"023", # drugs,
"122", #prostitution
"1251", #life insurance
"12530B", # hospital insurance
"12530C" # health insurance
)
#create searchquery for all elements included by nbb (and their child elements)
include_query <-  paste0("^(", paste(include_selection$COICOP, collapse = "|"), ")")
#create searchquery for all elements removed by nbb (and their child elements)
exclude_query <- paste0("^(", paste(exclude_selection, collapse = "|"), ")")
#get basic product groups selected by nbb
filtered_hbs_v2 <- df_hbs %>%
filter(str_detect(COICOP, include_query)) %>% #apply INCLUDE query
filter(!str_detect(COICOP, exclude_query)) %>%  #apply EXCLUDE query
filter(COICOP_LVL == 5)
#summarize filtered hbs to coicop level 4
recalc_hbs_coicop3 <- filtered_hbs_v2 %>%
mutate(
COICOP3_parent = substr(COICOP, 1,4) #get parent coicop level so we can match afterwards
) %>%
group_by(COICOP3_parent, category, hbs_year) %>%
summarize(value = sum(value, na.rm=T))
# calculate total expenditure by income group
recalc_group_expenditure_v2 <-  filtered_hbs_v2 %>%
group_by(category, hbs_year) %>%
summarize(recalc_total_group_expenditure = sum(value, na.rm=T))
#calculate relative weights from each product group in relation to total expenditure by income group
new_weights_coicop3 <- recalc_hbs_coicop3 %>%
left_join(recalc_group_expenditure_v2, by=c("category", "hbs_year")) %>%
rename("CD_COICOP" = "COICOP3_parent") %>%
group_by(CD_COICOP,category, hbs_year ) %>%
summarize(
nw_wt = (value / recalc_total_group_expenditure)*1000
)
#mean cpi index in year of hbs publication
yearly_mean_index_coicop3 <- df_cpi %>%
filter(NM_CD_COICOP_LVL == 3) %>%
group_by(CD_COICOP, NM_YR) %>%
summarize(mean_cpi_idx_hbs_year = mean(MS_CPI_IDX, na.rm=T)) %>%
filter(NM_YR %in% unique(df_hbs$hbs_year)) %>%
select(hbs_year = NM_YR, CD_COICOP, mean_cpi_idx_hbs_year)
#cpi index in december of year-1
idx_dec_coicop3 <- df_cpi %>%
filter(NM_CD_COICOP_LVL == 3) %>%
filter(NM_MTH == 12) %>%
filter(NM_YR >= 2012) %>%
rename("year_dec_value"="NM_YR") %>%
mutate(
hbs_year = ifelse(year_dec_value %% 2, year_dec_value - 1, year_dec_value - 2),
year_to_update = year_dec_value  + 1
) %>%
select(hbs_year, year_dec_value, year_to_update, CD_COICOP, cpi_idx_dec = MS_CPI_IDX)
#calculate "update" factor
update_factors_coicop3 <- yearly_mean_index_coicop3 %>%
left_join(idx_dec_coicop3, by=c("hbs_year", "CD_COICOP")) %>%
mutate(
update_factor = cpi_idx_dec / mean_cpi_idx_hbs_year
) %>%
select(CD_COICOP, hbs_year, year_dec_value, year_to_update, update_factor ) %>%
mutate(
hbs_year = as.numeric(hbs_year),
year_dec_value = as.numeric(year_dec_value)
)
updated_weights_coicop3 <- new_weights_coicop3 %>%
left_join(update_factors_coicop3, by=c("CD_COICOP", "hbs_year")) %>%
mutate(updated_wt = nw_wt * update_factor) %>%
filter(!is.na(updated_wt))  %>%
ungroup() %>%
group_by(year_to_update, category) %>%  #rescale to 1000
mutate(
total = sum(updated_wt, na.rm=T)
) %>%
ungroup() %>%
mutate(
nw_wt = (updated_wt / total)*1000
) %>%
select(CD_COICOP, category, year = year_to_update, updated_wt)
#make clean copy of original cpi dataframe before merge
df_cpi_for_merge <- df_cpi %>%
select(date, CD_COICOP, NM_CD_COICOP_LVL, MS_CPI_IDX, MS_WT_CPI) %>%
mutate(year = year(date))
#merge rescaled and updated hbs-data with cpi data
df_merged_cpi_hbs_v2 <- updated_weights_coicop3 %>%
left_join(df_cpi_for_merge, by=c("CD_COICOP", "year"))
#inflation as published by statbel
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL== 0 ) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
inflation = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = inflation -  MS_CPI_INFL) #difference between published en reproduced inflation
infl_comparisson
#average difference between published and reproduced inflation
mean(infl_comparisson$diff, na.rm=T)
#inflation as published by statbel
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL== 0 ) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
infl_repro = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(inflation = round(inflation, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = infl_repro -  MS_CPI_INFL) #difference between published en reproduced inflation
#inflation as published by statbel
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL== 0 ) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
infl_repro = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(inflation = round(infl_repro, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = infl_repro -  MS_CPI_INFL) #difference between published en reproduced inflation
infl_comparisson
#average difference between published and reproduced inflation
mean(infl_comparisson$diff, na.rm=T)
#inflation as published by statbel
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL== 0 ) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
infl_repro = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(infl_repro = round(infl_repro, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = infl_repro -  MS_CPI_INFL) #difference between published en reproduced inflation
infl_comparisson
#average difference between published and reproduced inflation
mean(infl_comparisson$diff, na.rm=T)
#inflation as published by statbel
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL== 0 ) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
infl_repro = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(infl_repro = round(infl_repro, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(diff = abs(infl_repro -  MS_CPI_INFL)) #difference between published en reproduced inflation
infl_comparisson
#average difference between published and reproduced inflation
mean(infl_comparisson$diff, na.rm=T)
#inflation as published by statbel
df_published_infl <- df_cpi %>%
filter(NM_CD_COICOP_LVL== 0 ) %>%
select(date, MS_CPI_INFL) %>%
mutate(
MS_CPI_INFL = round(as.numeric(MS_CPI_INFL)*100, 2)
)
#reproduce inflation
df_inflation_hbs_wt <- df_merged_cpi_hbs_v2 %>%
group_by(date, category) %>%
summarize(
reproduced_index = weighted.mean(MS_CPI_IDX, updated_wt)
) %>%
ungroup() %>%
mutate(
month = month(date),
) %>%
group_by(category, month) %>%
mutate(
idx_lag1y = lag(reproduced_index, 1),
infl_repro = ((reproduced_index - idx_lag1y) / idx_lag1y)*100
)
#compare reproduced inflation and published inflation
infl_comparisson <- df_inflation_hbs_wt %>%
filter(date >= ymd("2021-01-01")) %>%
arrange(desc(date)) %>%
mutate(infl_repro = round(infl_repro, 2)) %>%
filter(category == "TOTAL") %>%
left_join(df_published_infl, "date") %>%
mutate(abs_diff = abs(infl_repro -  MS_CPI_INFL)) #difference between published en reproduced inflation
infl_comparisson
#average difference between published and reproduced inflation
mean(infl_comparisson$diff, na.rm=T)
#weighted average
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 2) %>%
summarize(
test_idx = weighted.mean(MS_CPI_IDX, MS_WT_CPI)
)
#result = 114.405
#published result
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 0) %>%
select(NM_YR, NM_MTH, MS_CPI_IDX)
#result = 114.2
#weighted average
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 1) %>%
summarize(
test_idx = weighted.mean(MS_CPI_IDX, MS_WT_CPI)
)
#result = 114.405
#published result
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 0) %>%
select(NM_YR, NM_MTH, MS_CPI_IDX)
#result = 114.2
#weighted average
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 2) %>%
summarize(
test_idx = weighted.mean(MS_CPI_IDX, MS_WT_CPI)
)
#result = 114.405
#published result
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 0) %>%
select(NM_YR, NM_MTH, MS_CPI_IDX)
#result = 114.2
#weighted average
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 3) %>%
summarize(
test_idx = weighted.mean(MS_CPI_IDX, MS_WT_CPI)
)
#result = 114.405
#published result
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 0) %>%
select(NM_YR, NM_MTH, MS_CPI_IDX)
#result = 114.2
#weighted average
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 2) %>%
summarize(
test_idx = weighted.mean(MS_CPI_IDX, MS_WT_CPI)
)
#result = 114.405
#published result
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 0) %>%
select(NM_YR, NM_MTH, MS_CPI_IDX)
#result = 114.2
#weighted average
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 1) %>%
summarize(
test_idx = weighted.mean(MS_CPI_IDX, MS_WT_CPI)
)
#result = 114.405
#published result
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 0) %>%
select(NM_YR, NM_MTH, MS_CPI_IDX)
#result = 114.2
#weighted average
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 2) %>%
summarize(
test_idx = weighted.mean(MS_CPI_IDX, MS_WT_CPI)
)
#result = 114.405
#published result
df_cpi %>%
filter(NM_YR == 2021 & NM_MTH == 10 & NM_CD_COICOP_LVL == 0) %>%
select(NM_YR, NM_MTH, MS_CPI_IDX)
#result = 114.2
